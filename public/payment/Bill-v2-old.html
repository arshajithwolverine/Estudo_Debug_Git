<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="apple-touch-icon" sizes="76x76" href="apple-icon.png">
  <link rel="icon" type="image/png" href="apple-icon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>
    Reciept
  </title>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no"
    name="viewport">
  <!--     Fonts and icons     -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->

  <!-- Latest compiled and minified JavaScript -->
  <script defer src="/__/firebase/7.7.0/firebase-app.js"></script>
  <script defer src="/__/firebase/7.7.0/firebase-firestore.js"></script>
  <script defer src="/__/firebase/init.js"></script>
  <style>
    /* Center the loader */
    #loader {
      position: absolute;
      left: 50%;
      top: 50%;
      z-index: 1;
      width: 150px;
      height: 150px;
      margin: -75px 0 0 -75px;
      border: 16px solid #f3f3f3;
      border-radius: 50%;
      border-top: 16px solid #3498db;
      width: 120px;
      height: 120px;
      -webkit-animation: spin 2s linear infinite;
      animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
      0% {
        -webkit-transform: rotate(0deg);
      }

      100% {
        -webkit-transform: rotate(360deg);
      }
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Add animation to "page content" */
    .animate-bottom {
      position: relative;
      -webkit-animation-name: animatebottom;
      -webkit-animation-duration: 1s;
      animation-name: animatebottom;
      animation-duration: 1s
    }

    @-webkit-keyframes animatebottom {
      from {
        bottom: -100px;
        opacity: 0
      }

      to {
        bottom: 0px;
        opacity: 1
      }
    }

    @keyframes animatebottom {
      from {
        bottom: -100px;
        opacity: 0
      }

      to {
        bottom: 0;
        opacity: 1
      }
    }
  </style>

</head>

<body class="container-fluid">
  <div id="loader"></div>
  <div id="notloader" style="display: none;">
    <br>
    <br>
    <div class="row">
      <div class="col-md-3"></div>
      <div class="col-md-6 ">
        <div class="row">
          <div class=" col-md-6 col-xs-6">
            <br>
            <img src="wel.svg" height="60">
            <br>
            <br>
          </div>
          <div class="col-md-6 text-right col-xs-6">
            <br>
            <!-- <img src="../razor.svg" height="60"/> -->
            <br>
            <br>
          </div>
        </div>
        <h3 id="billid">Invoice #ID</h3>
        <div class="row">
          <div class=" col-md-6 col-xs-6">
            <p>From,<br>Learning App<br>
              ThinkersInk<br>
              Door 110</p>
          </div>
          <div class="col-md-6 text-right col-xs-6">
            <p id="AddressData">To,<br>Learning App<br>
              ThinkersInk<br>
              Door 110</p>
          </div>
        </div>

        <div>
          <form>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>BILL DATE</label>
                  <input type="date" class="form-control" id="billdate" value="" disabled>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label>EXPIRY DATE</label>
                  <input type="date" class="form-control" id="expdate" value="" disabled>
                </div>
              </div>
              <div class="col-md-6">

              </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                <div>
                  <table class="table">
                    <thead class=" text-primary">
                      <tr>
                        <th class="col-md-6">
                          Description
                        </th>
                        <th class="text-center col-md-2">
                          Rate/Item
                        </th>
                        <th class="text-center col-md-2">
                          Quantity
                        </th>
                        <th class="text-right col-md-2">
                          Total
                        </th>
                      </tr>
                    </thead>
                    <tbody id="BillTable">
                      <tr>
                        <td class="col-md-6">Paper 1</td>
                        <td class="col-md-2">Rs. 100</td>
                        <td class="col-md-2">1</td>
                        <td class="text-right col-md-2">Rs. 100</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <br>
            <br>
            <div class="row">
              <div class="col-md-6">

              </div>
              <div class="col-md-3 text-right">
                <h4>Total Amount</h4>
              </div>
              <div class="col-md-3 text-right">
                <h4 id='BillAmount'>Rs. 100</h4>
              </div>
            </div>
            <div class=" row">
              <div class="col-md-12 text-center">
                <button type="submit" class="btn btn-primary btn-round" onclick="goingback()">Go Back</button>
              </div>
            </div>
          </form>
          <br>
          <br>
          <div class="card-header">
            <h4> </h4>
            <h5> </h5>
            <!-- <h4>Customer Notes</h4> -->
            <!-- <h5>Will be given</h5> -->
          </div>
          <br>
          <div class="card-header">
            <h4> </h4>
            <h5> </h5>
            <!-- <h4>Terms and Conditions</h4>
                    <h5>Will be given</h5> -->
          </div>
          <br>
        </div>
      </div>
      <div class="col-md-3"></div>

    </div>

    <footer class="footer">
      <div class="col-md-3"></div>
      <div class="container-fluid col-md-6 text-center">
        <div class="row">
          <div>
            <span>
              Â©
              <script>
                document.write(new Date().getFullYear())
              </script> Estudo, made with <i class="fa fa-heart heart"></i> by Epoch Zero
            </span>
          </div>
        </div>
      </div>
      <div class="col-md-3"></div>
      <br>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      app = firebase.app();
      console.log(app);
      db = firebase.firestore();

      url = window.location.href;
      var queryStart = url.indexOf("?") + 1;
      queryEnd = url.indexOf("#") + 1 || url.length + 1;
      query = url.slice(queryStart, queryEnd - 1);
      params = query.split("=", 2);




      element = document.getElementById('loader');
      db.collection("Orders").doc(params[1]).get().then(snap => {
        Billdata = snap.data();
        console.log(Billdata);
        document.getElementById("AddressData").innerHTML = `
                        Billed To,<br>${Billdata.User.UserName}<br>${Billdata.User.Contact}<br>
                        ${Billdata.User.Email}
                `;
        html = ""
        Amount = Billdata.Amount // (1 - (Billdata.Discount / 100));


        for (let index = 0; index < Billdata.Item.length; index++) {
          const element = Billdata.Item[index];


          if (element.category === "Mock_Test") {
            html += `
                              <tr>
                                <td class="col-md-6">${element.Name}(Mock Exam)</td>
                                <td class="text-center col-md-2">Rs. ${element.Price}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. ${element.Price}</td>
                              </tr>
                    `
          }
          else if (element.category === "Study_Materials") {
            html += `
                              <tr>
                                <td class="col-md-6">${element.Name}(Study Materials)</td>
                                <td class="text-center col-md-2">Rs. ${element.Price}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. ${element.Price}</td>
                              </tr>
                    `
          }
          else if (element.category === "Courses") {
            if (element.type === "net") {

              html += `
                              <tr>
                                <td class="col-md-6">${element.Name}(Video Lectures)</td>
                                <td class="text-center col-md-2">Rs. ${element.Price}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. ${element.Price}</td>
                              </tr>
                    `
              if (element.mock_flag) {
                html += `
                             <tr>
                                <td class="col-md-6">${element.Name}(Mock Exam)</td>
                                <td class="text-center col-md-2">Free</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. 0</td>
                              </tr>
                        `;
              }
            }
            else if (element.type === "degree") {
              html += `
                              <tr>
                                <td class="col-md-6">${element.name}(Video Lectures) in ${element.degreeecourse.Name}</td>
                                <td class="text-center col-md-2">Rs. ${element.Price}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. ${element.Price}</td>
                              </tr>
                    `;
            }
            else if (element.type === "Skilled_Courses") {
              html += `
                              <tr>
                                <td class="col-md-6">${element.Name}(Video Lectures)</td>
                                <td class="text-center col-md-2">Rs. ${element.Price}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. ${element.Price}</td>
                              </tr>
                    `;
            }
            else if (element.type === "Courses") {
              html += `
                              <tr>
                                <td class="col-md-6">${element.Name}(Video Lectures)</td>
                                <td class="text-center col-md-2">Rs. ${element.Price}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">Rs. ${element.Price}</td>
                              </tr>
                    `;

            }

          }


        }




        if (Billdata.Discount > 0) {
          html = html + `
                              <tr>
                                <td class="col-md-6">Coupon Applied :- ${Billdata.Coupon.Couponcode} (${Billdata.Discount}% OFF)</td>
                                <td class="text-center col-md-2">- Rs. ${Amount - Billdata.Amount}</td>
                                <td class="text-center col-md-2">1</td>
                                <td class="text-right col-md-2">- Rs. ${Amount - Billdata.Amount}</td>
                              </tr>
                        `
        }







        console.log(html)

        document.getElementById("BillTable").innerHTML = html;
        document.getElementById("BillAmount").innerHTML = "Rs. " + Billdata.Amount;
        document.getElementById("billdate").value = Billdata.OrderIssueDate.replace("/", "-").replace("/", "-");
        document.getElementById("expdate").value = yearplusone(Billdata.OrderIssueDate);
        document.getElementById("billid").innerHTML = Billdata.OrderRecieptId;
        document.getElementById("notloader").style.display = "block"
        element.parentNode.removeChild(element);
      })
    })

    function yearplusone(datestring) {
      exparr = datestring.split("/");
      exparr[0] = Number(exparr[0]) + 1;
      return exparr.join("-");
    }
    function goingback() {
      invokeCSharpAction("success");
    }
  </script>

</body>

</html>